---
Workout: true
Workout-Type: "discipline"
Timestamp: "2026-01-22T13:39:59+02:00"
muscleGroups: ["Side Delts","Biceps","Forearms","Lats"]
exercises: [{"name":"Dumbbell Curl","muscle":"Biceps","muscleGroup":"Biceps","sets":[{"weight":6.7,"reps":13,"completed":true,"isWarmup":true},{"weight":9,"reps":10,"completed":true,"isWarmup":true},{"weight":11.4,"reps":4,"completed":true,"isWarmup":true},{"weight":14.3,"reps":7,"completed":true,"isWarmup":false}]},{"name":"Pull Ups","muscle":"Lats","muscleGroup":"Lats","sets":[{"weight":5,"reps":5,"completed":true,"isWarmup":false},{"weight":4,"reps":4,"completed":true,"isWarmup":false}]},{"name":"Dumbbell Lateral Raise","muscle":"Side Delts","muscleGroup":"Side Delts","sets":[{"weight":6,"reps":10,"completed":true,"isWarmup":true},{"weight":8,"reps":6,"completed":true,"isWarmup":true},{"weight":10,"reps":3,"completed":true,"isWarmup":true},{"weight":11.6,"reps":7,"completed":true,"isWarmup":false},{"weight":11.8,"reps":7,"completed":true,"isWarmup":false},{"weight":11.8,"reps":8,"completed":true,"isWarmup":false},{"weight":9,"reps":15,"completed":true,"isWarmup":false},{"weight":6.7,"reps":15,"completed":true,"isWarmup":false}]},{"name":"Hammer Curl","muscle":"Forearms","muscleGroup":"Forearms","sets":[{"weight":14,"reps":11,"completed":true,"isWarmup":false}]}]
currentMuscleIndex: 3
cssclasses:
  - hide-properties
banner: "![[Workout session.jpg]]"
---

```dataviewjs
// IN-WORKOUT TRACKER v3.7
const VAULT_NAME="Alt society",WORKOUT_FOLDER="Personal Life/01 Workout",STATS_FILE="Personal Life/Personal Stats.md",EXERCISE_DB_FOLDER="Home/Activities/Exercises database";
const THEME={color:"#9a8c7a",colorHover:"#aa9c8a",colorBorder:"#3a342a",colorMuted:"#6a5a4a",colorDiscipline:"#a89860",colorFlow:"#6a8a9a"};
const STRENGTH_LEVELS={"Untrained":{color:"#6a6a6a",icon:"‚óã"},"Beginner":{color:"#a89860",icon:"‚óê"},"Novice":{color:"#7a9a7d",icon:"‚óë"},"Intermediate":{color:"#6a8a9a",icon:"‚óï"},"Advanced":{color:"#8a7a9a",icon:"‚óè"},"Elite":{color:"#9a6a7a",icon:"‚òÖ"}};
const currentFile=dv.current().file,fm=dv.current();
const MUSCLE_GROUPS=fm.muscleGroups||["Side Delts","Biceps","Forearms","Lats"];
let exercises=fm.exercises||[{"name":"Dumbbell Curl","muscle":"Biceps","muscleGroup":"Biceps","sets":[{"weight":10,"reps":10,"completed":false,"isWarmup":true},{"weight":13,"reps":6,"completed":false,"isWarmup":true},{"weight":16,"reps":3,"completed":false,"isWarmup":true},{"weight":19,"reps":10,"completed":false,"isWarmup":false}]},{"name":"Pull Ups","muscle":"Lats","muscleGroup":"Lats","sets":[{"weight":0,"reps":10,"completed":false,"isWarmup":false},{"weight":0,"reps":10,"completed":false,"isWarmup":false},{"weight":0,"reps":10,"completed":false,"isWarmup":false}]}];
let currentMuscleIndex=fm.currentMuscleIndex||0;

if(!document.getElementById('w-inline-v37')){const s=document.createElement('style');s.id='w-inline-v37';s.textContent='.set-row{transition:all .3s ease}.set-row:hover{background:#1a1814!important}.set-row.completed{opacity:.6}.ctrl-btn{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:#0f0f0f;border:1px solid #3a342a;color:#9a8c7a;cursor:pointer;font-size:16px;flex-shrink:0}.ctrl-btn:hover{background:#9a8c7a;color:#0a0a0a}@keyframes breathe{0%,100%{box-shadow:inset 0 0 20px rgba(154,140,122,.03)}50%{box-shadow:inset 0 0 40px rgba(154,140,122,.08)}}.strength-bar{height:6px;background:#1a1a1a;border-radius:3px;overflow:hidden}.strength-bar-fill{height:100%;border-radius:3px;transition:width .6s cubic-bezier(.4,0,.2,1)}.strength-title-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:4px;font-size:12px;font-weight:700;letter-spacing:2px;text-transform:uppercase}.pr-info-box{display:flex;flex-direction:column;gap:4px;padding:10px 12px;background:rgba(168,152,96,.1);border:1px solid rgba(168,152,96,.3);border-radius:4px;margin-top:8px}.missing-standard-warning{display:flex;align-items:center;gap:8px;padding:8px 12px;background:rgba(154,106,106,.1);border:1px dashed rgba(154,106,106,.4);border-radius:4px;color:#9a6a6a;font-size:11px;font-style:italic;margin-top:8px}.warmup-indicator{font-size:9px;color:#6a8a9a;padding:2px 6px;background:rgba(106,138,154,.15);border-radius:3px}';document.head.appendChild(s);}

function addCorners(el,color,size=14){['TL','TR','BL','BR'].forEach(pos=>{const c=document.createElement('div');const isTop=pos.includes('T'),isLeft=pos.includes('L');c.style.cssText='position:absolute;'+(isTop?'top:0':'bottom:0')+';'+(isLeft?'left:0':'right:0')+';width:'+size+'px;height:'+size+'px;border-'+(isTop?'top':'bottom')+':1px solid '+color+';border-'+(isLeft?'left':'right')+':1px solid '+color+';z-index:10;pointer-events:none;';el.appendChild(c);});}
function calculate1RM(w,r){if(r===0||w===0)return 0;if(r===1)return w;return Math.round(w*(1+r/30));}
function updateWarmupWeights(ex,newW){const warmups=ex.sets.filter(s=>s.isWarmup);[0.5,0.7,0.85].forEach((p,i)=>{if(warmups[i])warmups[i].weight=Math.round(newW*p);});}
function getFirstWorkingSetIndex(sets){return sets.findIndex(s=>!s.isWarmup);}

async function getPersonalStats(){const f=app.vault.getAbstractFileByPath(STATS_FILE);if(!f)return{weight:61,height:175,birthdate:"2005-11-29"};const c=app.metadataCache.getFileCache(f);const fm=c?.frontmatter||{};return{weight:fm.Weight||61,height:fm.Height||175,birthdate:fm.Birthdate||"2005-11-29"};}
function calculateAge(bd){if(!bd)return 20;const b=new Date(bd),t=new Date();let a=t.getFullYear()-b.getFullYear();if(t.getMonth()<b.getMonth()||(t.getMonth()===b.getMonth()&&t.getDate()<b.getDate()))a--;return a;}
function parseStandardValue(v){if(typeof v!=='string')v=String(v);v=v.trim();if(v.includes('<')){const n=parseFloat(v.replace(/[<\s]/g,''));return(!isNaN(n)&&n>0)?n*0.5:0.1;}const n=parseFloat(v);return isNaN(n)?0:n;}

async function getStrengthStandard(name){const fp=EXERCISE_DB_FOLDER+"/"+name+".md";const f=app.vault.getAbstractFileByPath(fp);if(!f)return null;const c=app.metadataCache.getFileCache(f);const isBW=c?.frontmatter?.Type==="Bodyweight";const content=await app.vault.read(f);const lines=content.split('\n');const bwT=[],ageT=[];let ct=null;for(const line of lines){if(line.includes('| BW')){ct='bw';continue;}if(line.includes('| Age')){ct='age';continue;}if(line.startsWith('|---')||line.startsWith('| ---'))continue;const m=line.match(/\|\s*([^|]+)\s*\|\s*([^|]+)\s*\|\s*([^|]+)\s*\|\s*([^|]+)\s*\|\s*([^|]+)\s*\|\s*([^|]+)\s*\|/);if(m){const row={key:parseStandardValue(m[1]),beginner:parseStandardValue(m[2]),novice:parseStandardValue(m[3]),intermediate:parseStandardValue(m[4]),advanced:parseStandardValue(m[5]),elite:parseStandardValue(m[6])};if(row.key>0&&(row.beginner>0||row.novice>0||row.intermediate>0)){if(ct==='bw')bwT.push(row);else if(ct==='age')ageT.push(row);}}}return{bwTable:bwT,ageTable:ageT,isBodyweight:isBW,hasValidData:bwT.length>0||ageT.length>0};}

function interpolateStandard(t,v){if(!t||t.length===0)return null;const s=[...t].sort((a,b)=>a.key-b.key);let lo=s[0],hi=s[s.length-1];for(let i=0;i<s.length-1;i++){if(s[i].key<=v&&s[i+1].key>=v){lo=s[i];hi=s[i+1];break;}}if(v<=lo.key)return{...lo};if(v>=hi.key)return{...hi};const r=(v-lo.key)/(hi.key-lo.key);return{key:v,beginner:lo.beginner+r*(hi.beginner-lo.beginner),novice:lo.novice+r*(hi.novice-lo.novice),intermediate:lo.intermediate+r*(hi.intermediate-lo.intermediate),advanced:lo.advanced+r*(hi.advanced-lo.advanced),elite:lo.elite+r*(hi.elite-lo.elite)};}

async function getAveragedStandards(std){const st=await getPersonalStats();const bw=interpolateStandard(std.bwTable,st.weight);const ag=interpolateStandard(std.ageTable,calculateAge(st.birthdate));if(bw&&ag)return{beginner:(bw.beginner+ag.beginner)/2,novice:(bw.novice+ag.novice)/2,intermediate:(bw.intermediate+ag.intermediate)/2,advanced:(bw.advanced+ag.advanced)/2,elite:(bw.elite+ag.elite)/2};return bw||ag||null;}

function determineStrengthLevel(cv,std){if(!std||cv<0)return{level:"Untrained",color:"#6a6a6a",progress:0,nextTarget:std?.beginner||1};const{beginner:b,novice:n,intermediate:i,advanced:a,elite:e}=std;if(cv>=e)return{level:"Elite",color:"#9a6a7a",progress:100,nextTarget:null};if(cv>=a)return{level:"Advanced",color:"#8a7a9a",progress:((cv-a)/(e-a))*100,nextTarget:e};if(cv>=i)return{level:"Intermediate",color:"#6a8a9a",progress:((cv-i)/(a-i))*100,nextTarget:a};if(cv>=n)return{level:"Novice",color:"#7a9a7d",progress:((cv-n)/(i-n))*100,nextTarget:i};if(cv>=b)return{level:"Beginner",color:"#a89860",progress:((cv-b)/(n-b))*100,nextTarget:n};return{level:"Untrained",color:"#6a6a6a",progress:b>0?Math.max(0,(cv/b)*100):0,nextTarget:b};}

async function calculateStrengthLevel(name,w,r,maxR=null){const std=await getStrengthStandard(name);if(!std||!std.hasValidData)return null;const avg=await getAveragedStandards(std);if(!avg)return null;if(std.isBodyweight){const eff=maxR!==null?Math.max(r,maxR):r;const res=determineStrengthLevel(eff,avg);return{...res,currentValue:eff,isBodyweight:true,unit:'reps',displayLabel:'Max Reps'};}else{if(w<=0)return null;const est=calculate1RM(w,r);const res=determineStrengthLevel(est,avg);return{...res,currentValue:est,isBodyweight:false,unit:'kg',displayLabel:'Est. 1RM'};}}

async function hasStrengthStandard(name){const std=await getStrengthStandard(name);return std!==null&&std.hasValidData;}

async function getExercisePR(name){const std=await getStrengthStandard(name);const isBW=std?.isBodyweight||false;const files=app.vault.getMarkdownFiles().filter(f=>f.path.startsWith(WORKOUT_FOLDER));let best=null,bestV=0;for(const file of files){const fm=app.metadataCache.getFileCache(file)?.frontmatter;if(fm?.exercises&&Array.isArray(fm.exercises)&&fm.Workout===true){const ex=fm.exercises.find(e=>e.name===name);if(ex?.sets){for(const set of ex.sets){if(!set.isWarmup&&set.completed){if(isBW){if(set.reps>bestV){bestV=set.reps;best={...set,date:file.basename,prValue:bestV,isBodyweight:true};}}else if(set.weight>0){const est=calculate1RM(set.weight,set.reps);if(est>bestV){bestV=est;best={...set,date:file.basename,estimated1RM:est,prValue:est,isBodyweight:false};}}}}}}}return best;}

async function saveToFile(){const f=app.vault.getAbstractFileByPath(currentFile.path);if(!f)return;let c=await app.vault.read(f);c=c.replace(/exercises: \[.*?\](?=\n)/s,'exercises: '+JSON.stringify(exercises));c=c.replace(/currentMuscleIndex: \d+/,'currentMuscleIndex: '+currentMuscleIndex);await app.vault.modify(f,c);}

const container=dv.el("div","",{attr:{style:"max-width:500px;margin:0 auto;padding:20px 0;"}});

async function render(){container.innerHTML='';const currentMuscle=MUSCLE_GROUPS[currentMuscleIndex]||"No Muscle";const muscleExercises=exercises.filter(e=>e.muscle===currentMuscle||e.muscleGroup===currentMuscle);
const header=document.createElement('div');header.style.cssText='text-align:center;margin-bottom:24px;padding:20px;background:#0a0a0a;border:1px solid '+THEME.colorBorder+';position:relative;animation:breathe 6s ease-in-out infinite;';container.appendChild(header);addCorners(header,THEME.color);
const title=document.createElement('h2');title.textContent=currentMuscle.toUpperCase();title.style.cssText='margin:0;color:'+THEME.color+';font-size:24px;font-weight:600;letter-spacing:4px;';header.appendChild(title);
const progress=document.createElement('div');progress.textContent=(currentMuscleIndex+1)+' / '+MUSCLE_GROUPS.length;progress.style.cssText='color:'+THEME.colorMuted+';font-size:12px;margin-top:8px;';header.appendChild(progress);
const exContainer=document.createElement('div');exContainer.style.cssText='display:flex;flex-direction:column;gap:16px;';container.appendChild(exContainer);
if(muscleExercises.length===0){const empty=document.createElement('div');empty.style.cssText='text-align:center;padding:40px 20px;background:#0f0f0f;border:1px dashed '+THEME.colorBorder+';';empty.innerHTML='<p style="color:'+THEME.colorMuted+';margin:0;">No exercises for '+currentMuscle+' yet.</p>';exContainer.appendChild(empty);}else{for(const ex of muscleExercises){await renderExercise(exContainer,ex);}}
const addExBtn=document.createElement('button');addExBtn.textContent="+ ADD EXERCISE";addExBtn.style.cssText='width:100%;padding:14px;background:transparent;border:1px dashed '+THEME.colorBorder+';color:'+THEME.colorMuted+';font-size:13px;letter-spacing:2px;cursor:pointer;margin-top:16px;';addExBtn.onmouseover=()=>{addExBtn.style.borderColor=THEME.color;addExBtn.style.color=THEME.color;};addExBtn.onmouseout=()=>{addExBtn.style.borderColor=THEME.colorBorder;addExBtn.style.color=THEME.colorMuted;};addExBtn.onclick=()=>openAddExerciseModal(currentMuscle);container.appendChild(addExBtn);
const nav=document.createElement('div');nav.style.cssText='display:flex;gap:12px;margin-top:24px;';container.appendChild(nav);
if(currentMuscleIndex>0){const prevBtn=document.createElement('button');prevBtn.textContent="‚Üê PREVIOUS";prevBtn.style.cssText='flex:1;padding:14px;background:#0f0f0f;border:1px solid '+THEME.colorBorder+';color:'+THEME.colorMuted+';cursor:pointer;';prevBtn.onclick=async()=>{currentMuscleIndex--;await saveToFile();};nav.appendChild(prevBtn);}
if(currentMuscleIndex<MUSCLE_GROUPS.length-1){const nextBtn=document.createElement('button');nextBtn.textContent="NEXT MUSCLE ‚Üí";nextBtn.style.cssText='flex:1;padding:14px;background:'+THEME.color+';border:none;color:#0a0a0a;font-weight:600;letter-spacing:1px;cursor:pointer;';nextBtn.onclick=async()=>{currentMuscleIndex++;await saveToFile();};nav.appendChild(nextBtn);}else{const finishBtn=document.createElement('button');finishBtn.textContent="‚úì FINISH WORKOUT";finishBtn.style.cssText='flex:1;padding:14px;background:#7a9a7d;border:none;color:#0a0a0a;font-weight:600;letter-spacing:1px;cursor:pointer;';finishBtn.onclick=()=>openFinishModal();nav.appendChild(finishBtn);}}

async function renderExercise(container,ex){const card=document.createElement('div');card.style.cssText='background:#0a0a0a;border:1px solid '+THEME.colorBorder+';padding:16px;position:relative;';container.appendChild(card);addCorners(card,THEME.color,12);
const exHeader=document.createElement('div');exHeader.style.cssText='display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid '+THEME.colorBorder+';';card.appendChild(exHeader);
const leftCol=document.createElement('div');leftCol.style.cssText='flex:1;';exHeader.appendChild(leftCol);
const exTitle=document.createElement('h3');exTitle.textContent=ex.name;exTitle.style.cssText='margin:0 0 8px 0;color:'+THEME.color+';font-size:16px;letter-spacing:1px;';leftCol.appendChild(exTitle);
const hasStd=await hasStrengthStandard(ex.name);const pr=await getExercisePR(ex.name);
const workingSets=ex.sets.filter(s=>!s.isWarmup);let bestW=0,bestR=0,maxR=0;workingSets.forEach(s=>{if(s.reps>maxR)maxR=s.reps;if(s.weight>bestW||(s.weight===bestW&&s.reps>bestR)){bestW=s.weight;bestR=s.reps;}});
if(hasStd){let sl;if(pr){sl=pr.isBodyweight?await calculateStrengthLevel(ex.name,0,pr.prValue,pr.prValue):await calculateStrengthLevel(ex.name,pr.weight,pr.reps);}else if(bestW>0||maxR>0){sl=await calculateStrengthLevel(ex.name,bestW,bestR,maxR);}
if(sl){const li=STRENGTH_LEVELS[sl.level];const badge=document.createElement('div');badge.className='strength-title-badge';badge.style.cssText+='background:'+sl.color+'25;border:1px solid '+sl.color+'60;color:'+sl.color+';';badge.innerHTML=(li?.icon||'‚óã')+' '+sl.level.toUpperCase();leftCol.appendChild(badge);
const rmD=document.createElement('div');rmD.style.cssText='font-size:11px;color:'+THEME.colorMuted+';margin-top:6px;';rmD.innerHTML='<strong style="color:'+THEME.color+'">'+sl.displayLabel+': '+sl.currentValue+sl.unit+'</strong>';if(sl.nextTarget)rmD.innerHTML+=' ‚Üí Next: '+Math.round(sl.nextTarget)+sl.unit;leftCol.appendChild(rmD);
const pb=document.createElement('div');pb.className='strength-bar';pb.style.marginTop='6px';leftCol.appendChild(pb);const fill=document.createElement('div');fill.className='strength-bar-fill';fill.style.cssText='width:'+Math.min(100,sl.progress)+'%;background:'+sl.color+';';pb.appendChild(fill);}}else{const warn=document.createElement('div');warn.className='missing-standard-warning';warn.innerHTML='‚ö†Ô∏è Missing standards for "<strong>'+ex.name+'</strong>"';leftCol.appendChild(warn);}
if(pr){const prBox=document.createElement('div');prBox.className='pr-info-box';const prT=document.createElement('div');prT.style.cssText='font-size:11px;color:#a89860;font-weight:700;letter-spacing:1px;';prT.textContent=pr.isBodyweight?'üèÜ ALL-TIME PR: '+pr.prValue+' reps':'üèÜ ALL-TIME PR: '+pr.estimated1RM+'kg (1RM)';prBox.appendChild(prT);const prD=document.createElement('div');prD.style.cssText='font-size:10px;color:'+THEME.colorMuted+';';prD.textContent=pr.isBodyweight?'Best set: '+pr.reps+' reps':'Set: '+pr.weight+'kg √ó '+pr.reps+' reps';prBox.appendChild(prD);const beat=document.createElement('div');beat.style.cssText='font-size:11px;color:#7a9a7d;margin-top:4px;font-weight:600;';beat.textContent=pr.isBodyweight?'üéØ Beat it: '+(pr.reps+1)+'+ reps':'üéØ Beat it: '+pr.weight+'kg √ó '+(pr.reps+1)+' or '+Math.round(pr.weight*1.025)+'kg √ó '+pr.reps;prBox.appendChild(beat);leftCol.appendChild(prBox);}
const delExBtn=document.createElement('button');delExBtn.textContent='üóëÔ∏è';delExBtn.style.cssText='background:transparent;border:none;cursor:pointer;font-size:14px;opacity:0.5;';delExBtn.onclick=()=>{const idx=exercises.findIndex(e=>e===ex);if(idx>-1){exercises.splice(idx,1);render();}};exHeader.appendChild(delExBtn);
const setsContainer=document.createElement('div');setsContainer.style.cssText='display:flex;flex-direction:column;gap:8px;';card.appendChild(setsContainer);const warmupRefs=[];ex.sets.forEach((set,setIdx)=>{const refs=renderSet(setsContainer,set,setIdx,ex,warmupRefs);if(set.isWarmup&&refs.weightInput)warmupRefs.push(refs.weightInput);});
const addSetBtn=document.createElement('button');addSetBtn.textContent="+ Add Set";addSetBtn.style.cssText='margin-top:8px;padding:8px 12px;background:transparent;border:1px dashed '+THEME.colorBorder+';color:'+THEME.colorMuted+';font-size:12px;cursor:pointer;';addSetBtn.onclick=()=>{const last=ex.sets[ex.sets.length-1]||{weight:0,reps:10};ex.sets.push({weight:last.weight,reps:last.reps,completed:false,isWarmup:false});render();};card.appendChild(addSetBtn);}

function renderSet(container,set,setIdx,ex,warmupRefs){const row=document.createElement('div');row.className='set-row'+(set.completed?' completed':'');row.style.cssText='display:grid;grid-template-columns:auto 1fr auto auto;align-items:center;gap:12px;padding:12px;background:#0f0f0f;border:1px solid '+THEME.colorBorder+';';container.appendChild(row);const refs={weightInput:null};
const cb=document.createElement('div');cb.style.cssText='width:24px;height:24px;border:2px solid '+(set.completed?'#7a9a7d':THEME.colorBorder)+';background:'+(set.completed?'#7a9a7d':'transparent')+';display:flex;align-items:center;justify-content:center;cursor:pointer;color:#0a0a0a;font-weight:bold;';cb.textContent=set.completed?'‚úì':'';cb.onclick=()=>{set.completed=!set.completed;cb.style.borderColor=set.completed?'#7a9a7d':THEME.colorBorder;cb.style.background=set.completed?'#7a9a7d':'transparent';cb.textContent=set.completed?'‚úì':'';row.className='set-row'+(set.completed?' completed':'');};row.appendChild(cb);
const mid=document.createElement('div');mid.style.cssText='display:flex;align-items:center;gap:12px;flex-wrap:wrap;';row.appendChild(mid);
const wWrap=document.createElement('div');wWrap.style.cssText='display:flex;align-items:center;gap:4px;';mid.appendChild(wWrap);const wInput=document.createElement('input');wInput.type='number';wInput.value=set.weight;wInput.style.cssText='width:50px;padding:6px;background:#0a0a0a;border:1px solid '+THEME.colorBorder+';color:'+THEME.color+';text-align:center;font-size:14px;font-weight:600;';const firstW=getFirstWorkingSetIndex(ex.sets);const isFirst=!set.isWarmup&&setIdx===firstW;wInput.onchange=(e)=>{const nw=parseFloat(e.target.value)||0;set.weight=nw;if(isFirst){updateWarmupWeights(ex,nw);const ws=ex.sets.filter(s=>s.isWarmup);warmupRefs.forEach((inp,i)=>{if(ws[i])inp.value=ws[i].weight;});}};wWrap.appendChild(wInput);refs.weightInput=wInput;const kgL=document.createElement('span');kgL.textContent='kg';kgL.style.cssText='color:'+THEME.colorMuted+';font-size:12px;';wWrap.appendChild(kgL);
const rWrap=document.createElement('div');rWrap.style.cssText='display:flex;align-items:center;gap:4px;';mid.appendChild(rWrap);const minusBtn=document.createElement('button');minusBtn.className='ctrl-btn';minusBtn.textContent='‚àí';minusBtn.onclick=()=>{if(set.reps>1){set.reps--;rDisp.textContent=set.reps+'√ó';}};rWrap.appendChild(minusBtn);const rDisp=document.createElement('span');rDisp.textContent=set.reps+'√ó';rDisp.style.cssText='color:'+THEME.color+';font-size:14px;font-weight:600;min-width:30px;text-align:center;';rWrap.appendChild(rDisp);const plusBtn=document.createElement('button');plusBtn.className='ctrl-btn';plusBtn.textContent='+';plusBtn.onclick=()=>{set.reps++;rDisp.textContent=set.reps+'√ó';};rWrap.appendChild(plusBtn);
if(set.isWarmup){const badge=document.createElement('span');badge.className='warmup-indicator';badge.textContent='‚ö° Warmup';mid.appendChild(badge);}
if(ex.sets.length>1){const delBtn=document.createElement('button');delBtn.textContent='√ó';delBtn.style.cssText='width:28px;height:28px;background:transparent;border:1px solid #3a2828;color:#6a4a4a;cursor:pointer;font-size:16px;';delBtn.onclick=()=>{ex.sets.splice(setIdx,1);render();};row.appendChild(delBtn);}else{const ph=document.createElement('div');ph.style.width='28px';row.appendChild(ph);}return refs;}

function openAddExerciseModal(muscle){const modal=document.createElement('div');modal.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:flex;align-items:center;justify-content:center;z-index:9999;backdrop-filter:blur(4px);';
const content=document.createElement('div');content.style.cssText='background:#0a0a0a;padding:28px 20px;max-width:550px;width:90%;max-height:85vh;overflow-y:auto;display:flex;flex-direction:column;gap:16px;position:relative;';modal.appendChild(content);addCorners(content,THEME.color);
const title=document.createElement('h3');title.textContent='Add Exercise - '+muscle;title.style.cssText='color:'+THEME.color+';margin:0 0 16px 0;letter-spacing:2px;';content.appendChild(title);
const nameInput=document.createElement('input');nameInput.type='text';nameInput.placeholder='Exercise name...';nameInput.style.cssText='width:100%;padding:12px;background:#0f0f0f;border:1px solid '+THEME.colorBorder+';color:'+THEME.color+';font-size:14px;box-sizing:border-box;';content.appendChild(nameInput);
const warmupL=document.createElement('div');warmupL.textContent='Include warmup sets?';warmupL.style.cssText='color:'+THEME.colorMuted+';font-size:12px;';content.appendChild(warmupL);
const warmupC=document.createElement('div');warmupC.style.cssText='display:flex;gap:8px;';content.appendChild(warmupC);let incWarmup=true;
const wYes=document.createElement('button');wYes.textContent='Yes (suggested)';wYes.style.cssText='flex:1;padding:10px;background:rgba(154,140,122,0.2);border:1px solid '+THEME.color+';color:'+THEME.color+';cursor:pointer;';wYes.onclick=()=>{incWarmup=true;wYes.style.background='rgba(154,140,122,0.2)';wYes.style.borderColor=THEME.color;wNo.style.background='#0f0f0f';wNo.style.borderColor=THEME.colorBorder;};warmupC.appendChild(wYes);
const wNo=document.createElement('button');wNo.textContent='No';wNo.style.cssText='flex:1;padding:10px;background:#0f0f0f;border:1px solid '+THEME.colorBorder+';color:'+THEME.colorMuted+';cursor:pointer;';wNo.onclick=()=>{incWarmup=false;wNo.style.background='rgba(154,140,122,0.2)';wNo.style.borderColor=THEME.color;wYes.style.background='#0f0f0f';wYes.style.borderColor=THEME.colorBorder;};warmupC.appendChild(wNo);
const weightL=document.createElement('div');weightL.textContent='Working weight (kg) - 0 for bodyweight';weightL.style.cssText='color:'+THEME.colorMuted+';font-size:12px;';content.appendChild(weightL);
const weightInput=document.createElement('input');weightInput.type='number';weightInput.placeholder='0';weightInput.style.cssText='width:100%;padding:12px;background:#0f0f0f;border:1px solid '+THEME.colorBorder+';color:'+THEME.color+';font-size:14px;box-sizing:border-box;';content.appendChild(weightInput);
const btnC=document.createElement('div');btnC.style.cssText='display:flex;gap:12px;';content.appendChild(btnC);
const cancelBtn=document.createElement('button');cancelBtn.textContent='Cancel';cancelBtn.style.cssText='flex:1;padding:12px;background:#0f0f0f;border:1px solid '+THEME.colorBorder+';color:'+THEME.colorMuted+';cursor:pointer;';cancelBtn.onclick=()=>document.body.removeChild(modal);btnC.appendChild(cancelBtn);
const addBtn=document.createElement('button');addBtn.textContent='Add Exercise';addBtn.style.cssText='flex:1;padding:12px;background:'+THEME.color+';border:none;color:#0a0a0a;font-weight:600;cursor:pointer;';addBtn.onclick=()=>{const name=nameInput.value.trim();if(!name){new Notice('Please enter an exercise name');return;}const ww=parseFloat(weightInput.value)||0;const sets=[];if(incWarmup&&ww>0){sets.push({weight:Math.round(ww*0.5),reps:10,completed:false,isWarmup:true});sets.push({weight:Math.round(ww*0.7),reps:6,completed:false,isWarmup:true});sets.push({weight:Math.round(ww*0.85),reps:3,completed:false,isWarmup:true});}sets.push({weight:ww,reps:10,completed:false,isWarmup:false});sets.push({weight:ww,reps:10,completed:false,isWarmup:false});sets.push({weight:ww,reps:10,completed:false,isWarmup:false});exercises.push({name,muscle,muscleGroup:muscle,sets});document.body.removeChild(modal);render();};btnC.appendChild(addBtn);
modal.onclick=(e)=>{if(e.target===modal)document.body.removeChild(modal);};document.body.appendChild(modal);nameInput.focus();}

async function openFinishModal(){await saveToFile();const summaryData=[];for(const ex of exercises){const completed=ex.sets.filter(s=>!s.isWarmup&&s.completed);if(completed.length>0){const hasStd=await hasStrengthStandard(ex.name);const pr=await getExercisePR(ex.name);let bestW=0,bestR=0,maxR=0,sessionBest=0;for(const s of completed){if(s.reps>maxR)maxR=s.reps;if(s.weight>0){const est=calculate1RM(s.weight,s.reps);if(est>sessionBest){sessionBest=est;bestW=s.weight;bestR=s.reps;}}else if(s.reps>sessionBest){sessionBest=s.reps;bestR=s.reps;}}const sl=await calculateStrengthLevel(ex.name,bestW,bestR,maxR);summaryData.push({name:ex.name,muscle:ex.muscle,bestW,bestR,maxR,sessionBest,sl,hasStd,pr});}}
const modal=document.createElement('div');modal.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:flex;align-items:center;justify-content:center;z-index:9999;backdrop-filter:blur(4px);';
const content=document.createElement('div');content.style.cssText='background:#0a0a0a;padding:28px 20px;border:1px solid '+THEME.colorBorder+';max-width:550px;width:90%;max-height:85vh;display:flex;flex-direction:column;position:relative;';modal.appendChild(content);addCorners(content,THEME.color);
const scroll=document.createElement('div');scroll.style.cssText='overflow-y:auto;display:flex;flex-direction:column;gap:16px;flex:1;';content.appendChild(scroll);
const title=document.createElement('h2');title.textContent="WORKOUT COMPLETE";title.style.cssText='margin:0;color:#7a9a7d;font-size:16px;font-weight:700;letter-spacing:3px;text-align:center;';scroll.appendChild(title);
if(summaryData.length>0){const sec=document.createElement('div');sec.style.cssText='display:flex;flex-direction:column;gap:12px;';scroll.appendChild(sec);const secT=document.createElement('div');secT.textContent='SESSION SUMMARY';secT.style.cssText='color:'+THEME.colorMuted+';font-size:11px;letter-spacing:2px;text-align:center;';sec.appendChild(secT);
for(const ex of summaryData){const card=document.createElement('div');card.style.cssText='padding:14px;background:#0c0c0c;border:1px solid '+THEME.colorBorder+';border-radius:6px;';sec.appendChild(card);
const hdr=document.createElement('div');hdr.style.cssText='display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;';card.appendChild(hdr);const nm=document.createElement('span');nm.textContent=ex.name;nm.style.cssText='color:'+THEME.color+';font-weight:600;font-size:14px;';hdr.appendChild(nm);
if(ex.sl){const li=STRENGTH_LEVELS[ex.sl.level];const badge=document.createElement('span');badge.style.cssText='display:inline-flex;align-items:center;gap:4px;padding:4px 10px;background:'+ex.sl.color+'20;border:1px solid '+ex.sl.color+'50;border-radius:4px;color:'+ex.sl.color+';font-size:11px;font-weight:700;letter-spacing:1px;';badge.textContent=(li?.icon||'‚óã')+' '+ex.sl.level.toUpperCase();hdr.appendChild(badge);}
const stats=document.createElement('div');stats.style.cssText='display:flex;justify-content:space-between;margin-bottom:8px;font-size:12px;';card.appendChild(stats);const setI=document.createElement('span');setI.textContent=ex.sl?.isBodyweight?'Best: '+ex.maxR+' reps':'Best: '+ex.bestW+'kg √ó '+ex.bestR;setI.style.cssText='color:'+THEME.colorMuted+';';stats.appendChild(setI);if(ex.sl){const rmI=document.createElement('span');rmI.textContent=ex.sl.displayLabel+': '+ex.sl.currentValue+ex.sl.unit;rmI.style.cssText='color:'+THEME.color+';font-weight:600;';stats.appendChild(rmI);}
if(ex.pr){const prC=document.createElement('div');prC.style.cssText='font-size:11px;margin-bottom:8px;padding:6px 8px;background:rgba(168,152,96,0.1);border-radius:4px;';const cv=ex.sl?.currentValue||ex.sessionBest;if(cv>ex.pr.prValue){prC.style.background='rgba(122,154,125,0.15)';prC.innerHTML='<span style="color:#7a9a7d;font-weight:700;">üéâ NEW PR!</span> <span style="color:'+THEME.colorMuted+';">Previous: '+ex.pr.prValue+' ‚Üí Now: '+cv+'</span>';}else if(cv===ex.pr.prValue){prC.innerHTML='<span style="color:#a89860;">üèÜ Matched PR:</span> <span style="color:'+THEME.colorMuted+';">'+ex.pr.prValue+'</span>';}else{prC.innerHTML='<span style="color:'+THEME.colorMuted+';">üèÜ PR: '+ex.pr.prValue+'</span> <span style="color:#6a6a6a;">(today: '+cv+')</span>';}card.appendChild(prC);}
if(ex.sl&&ex.sl.nextTarget){const pb=document.createElement('div');pb.className='strength-bar';pb.style.marginTop='8px';card.appendChild(pb);const fill=document.createElement('div');fill.className='strength-bar-fill';fill.style.cssText='width:'+Math.min(100,ex.sl.progress)+'%;background:'+ex.sl.color+';';pb.appendChild(fill);const ti=document.createElement('div');ti.style.cssText='display:flex;justify-content:space-between;font-size:9px;color:'+THEME.colorMuted+';margin-top:4px;';ti.innerHTML='<span>Current: '+ex.sl.currentValue+ex.sl.unit+'</span><span>Next: '+Math.round(ex.sl.nextTarget)+ex.sl.unit+'</span>';card.appendChild(ti);}}}
const feelT=document.createElement('h3');feelT.textContent="How did it feel?";feelT.style.cssText='margin:8px 0 0 0;color:'+THEME.color+';font-size:13px;letter-spacing:3px;text-align:center;text-transform:uppercase;opacity:0.8;';scroll.appendChild(feelT);
const btns=document.createElement('div');btns.style.cssText='display:flex;flex-direction:column;gap:10px;';scroll.appendChild(btns);
function createBtn(icon,btnT,desc,bC,aC,onClick){const btn=document.createElement('div');btn.style.cssText='display:flex;align-items:center;gap:16px;padding:16px 20px;background:#0c0c0c;border:1px solid '+bC+';cursor:pointer;';btns.appendChild(btn);const iconEl=document.createElement('div');iconEl.textContent=icon;iconEl.style.cssText='font-size:24px;width:40px;text-align:center;';btn.appendChild(iconEl);const tw=document.createElement('div');tw.style.cssText='flex:1;';btn.appendChild(tw);const tEl=document.createElement('div');tEl.textContent=btnT;tEl.style.cssText='color:'+aC+';font-size:14px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:4px;';tw.appendChild(tEl);const dEl=document.createElement('div');dEl.textContent=desc;dEl.style.cssText='color:#5a5a5a;font-size:11px;font-style:italic;';tw.appendChild(dEl);const arrow=document.createElement('div');arrow.textContent='‚Üí';arrow.style.cssText='color:'+bC+';font-size:18px;opacity:0.5;';btn.appendChild(arrow);btn.onmouseover=()=>{btn.style.borderColor=aC;btn.style.background='#101010';arrow.style.color=aC;arrow.style.opacity='1';};btn.onmouseout=()=>{btn.style.borderColor=bC;btn.style.background='#0c0c0c';arrow.style.color=bC;arrow.style.opacity='0.5';};btn.onclick=async()=>{document.body.removeChild(modal);await onClick();};}
createBtn('üíé','Discipline','Pushed through resistance','#4a4030',THEME.colorDiscipline,()=>finishWorkout('discipline'));createBtn('üåä','Flow','Felt natural and effortless','#304050',THEME.colorFlow,()=>finishWorkout('flow'));
modal.onclick=(e)=>{if(e.target===modal)document.body.removeChild(modal);};document.body.appendChild(modal);}

async function finishWorkout(type){const f=app.vault.getAbstractFileByPath(currentFile.path);if(!f)return;let c=await app.vault.read(f);c=c.replace(/Workout: false/,'Workout: true');c=c.replace(/Workout-Type: ""/,'Workout-Type: "'+type+'"');await app.vault.modify(f,c);new Notice('üéâ Workout logged as '+(type==='discipline'?'Discipline Win':'Flow State')+'!');setTimeout(()=>{window.location.href='obsidian://open?vault='+encodeURIComponent(VAULT_NAME)+'&file='+encodeURIComponent('Home/Activities/Workout hub');},500);}

render();
```
